<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –°–∏—Å—Ç–µ–º—ã - –ü–æ–Ω—è—Ç–Ω–∞—è –°—Ö–µ–º–∞</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>
    <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.js"></script>
    <script src="https://unpkg.com/cytoscape-dagre@2.5.0/cytoscape-dagre.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #1e1e1e;
            color: #e0e0e0;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #header {
            background: #252526;
            padding: 15px 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        #header h1 {
            font-size: 18px;
            color: #4fc1ff;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
        }

        #controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        #search-box {
            padding: 8px 12px;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            background: #1e1e1e;
            color: #e0e0e0;
            font-size: 13px;
            width: 220px;
            transition: border-color 0.2s;
        }

        #search-box:focus {
            border-color: #4fc1ff;
            outline: none;
        }

        .btn {
            background: #3e3e42;
            color: #e0e0e0;
            border: 1px solid #454545;
            padding: 6px 14px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #4e4e52;
            border-color: #555;
        }

        .btn-primary {
            background: #0e639c;
            border-color: #1177bb;
            color: white;
        }

        .btn-primary:hover {
            background: #1177bb;
        }

        #main-container {
            flex: 1;
            display: flex;
            position: relative;
            height: 0;
            min-height: 0;
        }

        #cy {
            flex: 1;
            background: #1e1e1e;
            background-image:
                radial-gradient(#333 1px, transparent 1px);
            background-size: 20px 20px;
        }

        #sidebar {
            width: 480px;
            background: #252526;
            border-left: 1px solid #333;
            overflow-y: auto;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.3);
            height: 100%;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            background: #2d2d2d;
            border-bottom: 1px solid #3e3e42;
        }

        .sidebar-content {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }

        h2 {
            font-size: 18px;
            color: #dcdcaa;
            margin-bottom: 5px;
            font-weight: 600;
        }

        h3 {
            font-size: 13px;
            color: #9cdcfe;
            margin: 15px 0 8px 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        p {
            font-size: 14px;
            line-height: 1.6;
            color: #cccccc;
            margin: 8px 0;
        }

        /* Junior Section Styling */
        .junior-card {
            background: rgba(78, 201, 176, 0.08);
            border-left: 4px solid #4ec9b0;
            border-radius: 4px;
            padding: 16px;
            margin-bottom: 25px;
        }

        .junior-title {
            color: #4ec9b0;
            font-size: 14px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .junior-section {
            margin-bottom: 12px;
        }

        .junior-label {
            font-size: 11px;
            color: #888;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 4px;
            display: block;
        }

        .junior-text {
            color: #e0e0e0;
            font-size: 14px;
        }

        .analogy-text {
            color: #ce9178;
            font-style: italic;
            border-left: 2px solid #ce9178;
            padding-left: 10px;
            margin-top: 5px;
        }

        .code-block {
            background: #111;
            padding: 12px;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            color: #9cdcfe;
            border: 1px solid #333;
            white-space: pre-wrap;
            margin: 10px 0;
            line-height: 1.5;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        .metric-card {
            background: #333;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #444;
            text-align: center;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: #4fc1ff;
        }

        .metric-label {
            font-size: 12px;
            color: #aaa;
            margin-top: 6px;
        }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin-right: 6px;
            font-weight: 600;
            margin-top: 5px;
        }

        .tag-tech {
            background: #569cd6;
            color: white;
        }

        .tag-logic {
            background: #c586c0;
            color: white;
        }

        .tag-data {
            background: #ce9178;
            color: black;
        }

        #legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(37, 37, 38, 0.95);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #454545;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
            z-index: 100;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 6px 0;
        }

        .legend-box {
            width: 14px;
            height: 14px;
            margin-right: 10px;
            border-radius: 3px;
        }

        #zoom-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 100;
        }

        .zoom-btn {
            background: #252526;
            border: 1px solid #454545;
            color: #ccc;
            width: 36px;
            height: 36px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .zoom-btn:hover {
            background: #3e3e42;
            color: white;
        }

        .connection-list {
            list-style: none;
            padding: 0;
        }

        .connection-list li {
            padding: 10px;
            background: #2d2d2d;
            margin: 6px 0;
            border-radius: 4px;
            font-size: 13px;
            border-left: 3px solid #555;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
    <link rel="stylesheet" href="/index.css">
</head>

<body>

    <div id="header">
        <h1>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                <line x1="8" y1="21" x2="16" y2="21"></line>
                <line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
            –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ö–∞—Ä—Ç–∞ –ö–æ–¥–∞
        </h1>
        <div id="controls">
            <input type="text" id="search-box" placeholder="üîç –ù–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç..." />
            <button class="btn" onclick="resetView()">–°–±—Ä–æ—Å</button>
            <button class="btn" onclick="fitView()">–í–ø–∏—Å–∞—Ç—å</button>
            <button class="btn btn-primary" onclick="showCriticalPath()">‚ö° –ü–æ–∫–∞–∑–∞—Ç—å –ü—É—Ç—å</button>
        </div>
    </div>

    <div id="main-container">
        <div id="cy"></div>

        <div id="zoom-controls">
            <button class="zoom-btn" onclick="zoomIn()" title="–ü—Ä–∏–±–ª–∏–∑–∏—Ç—å">+</button>
            <button class="zoom-btn" onclick="zoomOut()" title="–û—Ç–¥–∞–ª–∏—Ç—å">‚àí</button>
            <button class="zoom-btn" onclick="resetView()" title="–°–±—Ä–æ—Å –º–∞—Å—à—Ç–∞–±–∞">‚ü≤</button>
        </div>

        <div id="legend">
            <div style="font-weight:bold; margin-bottom:8px; color:#ddd;">–£—Å–ª–æ–≤–Ω—ã–µ –û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è</div>
            <div class="legend-item">
                <div class="legend-box" style="background:#4ec9b0;"></div>–§—É–Ω–∫—Ü–∏—è (–î–µ–π—Å—Ç–≤–∏–µ)
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background:#ce9178;"></div>–î–∞–Ω–Ω—ã–µ (–§–∞–π–ª—ã)
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background:#569cd6;"></div>API (–í–Ω–µ—à–Ω–∏–π –ú–∏—Ä)
            </div>
            <div class="legend-item">
                <div class="legend-box" style="border:2px dashed #6a9955;"></div>–ì—Ä—É–ø–ø—ã / –ü–∞–ø–∫–∏
            </div>
        </div>

        <div id="sidebar">
            <!-- Default View -->
            <div class="sidebar-section" id="default-info">
                <div class="sidebar-header">
                    <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –†–∞–±–æ—Ç—ã</h2>
                </div>
                <div class="sidebar-content">
                    <p>–≠—Ç–æ —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —á–µ–∫–æ–≤. –í—ã–±–µ—Ä–∏—Ç–µ –ª—é–±–æ–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å,
                        –∫–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –∑–∞—á–µ–º –Ω—É–∂–µ–Ω.</p>

                    <div class="metric-grid">
                        <div class="metric-card">
                            <div class="metric-value">14,626</div>
                            <div class="metric-label">–ß–µ–∫–æ–≤ –≤ –æ—á–µ—Ä–µ–¥–∏</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">275</div>
                            <div class="metric-label">–ì–æ—Ç–æ–≤–æ</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">12 —à—Ç</div>
                            <div class="metric-label">–†–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">4 —Å–µ–∫</div>
                            <div class="metric-label">–°–∫–æ—Ä–æ—Å—Ç—å –ò–ò</div>
                        </div>
                    </div>

                    <h3>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞—Ä—Ç–æ–π?</h3>
                    <ul style="margin-left:20px; color:#bbb; font-size:13px; line-height:1.8;">
                        <li>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ <strong>–£–∑–µ–ª</strong>, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —á—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–∞ —á–∞—Å—Ç—å –∫–æ–¥–∞.</li>
                        <li>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ <strong>–°—Ç—Ä–µ–ª–∫—É</strong>, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è.</li>
                        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ —Å–≤–µ—Ä—Ö—É –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–π.</li>
                    </ul>
                </div>
            </div>

            <!-- Node Details View -->
            <div class="sidebar-section" id="node-details" style="display:none;">
                <div class="sidebar-header">
                    <h2 id="node-name">–ù–∞–∑–≤–∞–Ω–∏–µ –£–∑–ª–∞</h2>
                    <div id="node-tags"></div>
                </div>

                <div class="sidebar-content">
                    <!-- Junior Friendly Section -->
                    <div class="junior-card">
                        <div class="junior-title">
                            <span style="font-size:16px;">üéì</span> –î–ª—è –ù–æ–≤–∏—á–∫–∞ (Junior)
                        </div>
                        <div class="junior-section">
                            <span class="junior-label">–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:</span>
                            <div id="node-junior-text" class="junior-text"></div>
                        </div>
                        <div class="junior-section" id="node-analogy-container">
                            <span class="junior-label">–ü—Ä–∏–º–µ—Ä –∏–∑ –∂–∏–∑–Ω–∏:</span>
                            <div id="node-analogy-text" class="analogy-text"></div>
                        </div>
                    </div>

                    <h3>‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</h3>
                    <p id="node-description"></p>

                    <h3>üíª –ö–æ–¥ / –°—Ç—Ä—É–∫—Ç—É—Ä–∞</h3>
                    <div id="node-code" class="code-block"></div>

                    <h3>üîó –°–≤—è–∑–∏</h3>
                    <ul id="node-connections" class="connection-list"></ul>
                </div>
            </div>

            <!-- Edge Details View -->
            <div class="sidebar-section" id="edge-details" style="display:none;">
                <div class="sidebar-header">
                    <h2 id="edge-name">–°–≤—è–∑—å</h2>
                </div>

                <div class="sidebar-content">
                    <!-- Junior Friendly Section for Edges -->
                    <div class="junior-card">
                        <div class="junior-title">
                            <span style="font-size:16px;">üéì</span> –î–ª—è –ù–æ–≤–∏—á–∫–∞ (Junior)
                        </div>
                        <div class="junior-section">
                            <span class="junior-label">–ó–∞—á–µ–º —ç—Ç–∞ —Å–≤—è–∑—å?</span>
                            <div id="edge-junior-text" class="junior-text"></div>
                        </div>
                    </div>

                    <h3>üì¶ –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è?</h3>
                    <div id="edge-payload" class="code-block"></div>

                    <h3>‚è±Ô∏è –ö–∞–∫ —á–∞—Å—Ç–æ?</h3>
                    <p id="edge-timing" style="color: #4ec9b0; font-weight:bold;"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        var cy = cytoscape({
            container: document.getElementById('cy'),

            boxSelectionEnabled: false,
            autounselectify: false,

            style: [
                {
                    selector: 'node',
                    style: {
                        'content': 'data(label)',
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'color': '#fff',
                        'text-outline-width': 2,
                        'text-outline-color': '#1e1e1e',
                        'background-color': '#333',
                        'font-size': '12px',
                        'font-weight': '600',
                        'width': 'label',
                        'height': 'label',
                        'padding': '14px',
                        'shape': 'round-rectangle',
                        'border-width': 2,
                        'border-color': '#555',
                        'text-wrap': 'wrap'
                    }
                },
                {
                    selector: ':parent',
                    style: {
                        'text-valign': 'top',
                        'text-halign': 'center',
                        'background-opacity': 0.1,
                        'background-color': '#fff',
                        'border-color': '#666',
                        'border-width': 1,
                        'border-style': 'dashed',
                        'content': 'data(label)',
                        'font-size': '14px',
                        'color': '#888',
                        'padding': '30px',
                        'text-margin-y': -10
                    }
                },
                // Types
                {
                    selector: 'node[type="function"]',
                    style: {
                        'background-color': '#1e1e1e',
                        'border-color': '#4ec9b0',
                        'color': '#4ec9b0',
                        'text-outline-color': '#1e1e1e'
                    }
                },
                {
                    selector: 'node[type="data"]',
                    style: {
                        'background-color': '#1e1e1e',
                        'border-color': '#ce9178',
                        'color': '#ce9178',
                        'shape': 'cut-rectangle'
                    }
                },
                {
                    selector: 'node[type="api"]',
                    style: {
                        'background-color': '#1e1e1e',
                        'border-color': '#569cd6',
                        'color': '#569cd6',
                        'shape': 'diamond',
                        'padding': '20px'
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 2,
                        'target-arrow-shape': 'triangle',
                        'line-color': '#555',
                        'target-arrow-color': '#555',
                        'curve-style': 'bezier',
                        'label': 'data(label)',
                        'font-size': '10px',
                        'color': '#aaa',
                        'text-background-color': '#1e1e1e',
                        'text-background-opacity': 1,
                        'text-background-padding': '4px',
                        'text-rotation': 'autorotate'
                    }
                },
                {
                    selector: '.highlighted',
                    style: {
                        'background-color': '#0e639c',
                        'border-color': '#4fc1ff',
                        'line-color': '#4fc1ff',
                        'target-arrow-color': '#4fc1ff',
                        'color': '#fff',
                        'text-outline-color': '#0e639c',
                        'z-index': 999
                    }
                },
                {
                    selector: '.dimmed',
                    style: {
                        'opacity': 0.1
                    }
                }
            ],

            elements: {
                nodes: [
                    // Groups (Containers)
                    { data: { id: 'g_main', label: '–ì–ª–∞–≤–Ω—ã–π –°–∫—Ä–∏–ø—Ç (automate_checks.py)' } },
                    { data: { id: 'g_class', label: '–†–æ–±–æ—Ç-–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', parent: 'g_main' } },
                    { data: { id: 'g_ai', label: 'AI –ú–æ–¥—É–ª—å –ó—Ä–µ–Ω–∏—è' } },
                    { data: { id: 'g_server', label: '–°–µ—Ä–≤–µ—Ä –ù–∞–ª–æ–≥–æ–≤–æ–π' } },
                    { data: { id: 'g_google', label: 'Google Cloud' } },
                    { data: { id: 'g_files', label: '–ü–∞–ø–∫–∞ —Å –§–∞–π–ª–∞–º–∏' } },

                    // Data Nodes
                    {
                        data: {
                            id: 'f_excel',
                            label: 'Excel –§–∞–π–ª\\n(–°–ø–∏—Å–æ–∫ –ó–∞–¥–∞—á)',
                            parent: 'g_files',
                            type: 'data',
                            desc: '–§–∞–π–ª .xlsx, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π 14,626 —Å—Ç—Ä–æ–∫ —Å –¥–∞–Ω–Ω—ã–º–∏ —á–µ–∫–æ–≤. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ openpyxl.',
                            code: 'def load_checks_from_excel(self):\\n    wb = load_workbook(config.EXCEL_FILE)\\n    ws = wb.active\\n    # ...\\n    for row in ws.iter_rows(...):\\n        check_data = { "check_number": ... }\\n        checks.append(check_data)',
                            junior: '–≠—Ç–æ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–µ–ª, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å. –ü—Ä–æ–≥—Ä–∞–º–º–∞ —á–∏—Ç–∞–µ—Ç –µ–≥–æ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ, —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å, –∫–∞–∫–∏–µ —á–µ–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å.',
                            analogy: '–≠—Ç–æ —Ç–æ–ª—Å—Ç–∞—è –∞–º–±–∞—Ä–Ω–∞—è –∫–Ω–∏–≥–∞ —Å –∑–∞–∫–∞–∑–∞–º–∏ –Ω–∞ —Å—Ç–æ–ª–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞.',
                            input: '–ê—Å–∏–ª–±–µ–∫–æ–≤–∞...xlsx',
                            output: 'List[Dict]'
                        }
                    },
                    {
                        data: {
                            id: 'f_zip',
                            label: 'ZIP –ê—Ä—Ö–∏–≤\\n(–°–∫–∞–Ω –î–æ–∫—É–º–µ–Ω—Ç–æ–≤)',
                            parent: 'g_files',
                            type: 'data',
                            desc: '–ë–∏–Ω–∞—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç ZIP-–∞—Ä—Ö–∏–≤–∞, –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–π –≤ –ø–∞–º—è—Ç—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.',
                            code: 'if Path(config.ZIP_FILE).exists():\\n    with open(config.ZIP_FILE, "rb") as f:\\n        self.zip_file_content = f.read()',
                            junior: '–§–∞–π–ª —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏. –û–Ω –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –¥–ª—è –≤—Å–µ—Ö —á–µ–∫–æ–≤. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –æ–¥–∏–Ω —Ä–∞–∑ –µ–≥–æ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∏ –ø–æ—Ç–æ–º –≤–µ–∑–¥–µ –ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞–µ—Ç.',
                            analogy: '–ö—Å–µ—Ä–æ–∫–æ–ø–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞. –ï—ë –Ω—É–∂–Ω–æ –ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞—Ç—å –∫ –∫–∞–∂–¥–æ–º—É –∑–∞—è–≤–ª–µ–Ω–∏—é, –ø–æ—ç—Ç–æ–º—É –≤—ã —Å–¥–µ–ª–∞–ª–∏ –º–Ω–æ–≥–æ –∫–æ–ø–∏–π –æ–¥–Ω–æ–π –±—É–º–∞–∂–∫–∏.',
                            input: '–ê–°–ò–õ–ë–ï–ö–û–í–ê.zip',
                            output: 'bytes'
                        }
                    },
                    {
                        data: {
                            id: 'f_progress',
                            label: '–§–∞–π–ª –ü—Ä–æ–≥—Ä–µ—Å—Å–∞\\n(–°–¥–µ–ª–∞–Ω–æ)',
                            parent: 'g_files',
                            type: 'data',
                            desc: 'JSON —Ñ–∞–π–ª –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —á–µ–∫–æ–≤, —á—Ç–æ–±—ã –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å —Ä–∞–±–æ—Ç—É.',
                            code: 'def load_progress(self):\\n    if Path(config.PROGRESS_FILE).exists():\\n        with open(config.PROGRESS_FILE, "r") as f:\\n            return set(json.load(f))',
                            junior: '–ó–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞, –∫—É–¥–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–æ–º–µ—Ä–∞ –≥–æ—Ç–æ–≤—ã—Ö —á–µ–∫–æ–≤.',
                            analogy: '–°–ø–∏—Å–æ–∫, –≥–¥–µ –º—ã —Å—Ç–∞–≤–∏–º –≥–∞–ª–æ—á–∫–∏ "–í—ã–ø–æ–ª–Ω–µ–Ω–æ".',
                            input: 'progress.json',
                            output: 'Set[str]'
                        }
                    },

                    // Logic Nodes (Functions)
                    {
                        data: {
                            id: 'fn_init',
                            label: '–ù–∞—Å—Ç—Ä–æ–π–∫–∞\\n(Init)',
                            parent: 'g_class',
                            type: 'function',
                            desc: '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Å–∞ CheckAutomation: —Å–µ—Å—Å–∏—è, –∫—É–∫–∏, OCR –∏ —Ñ–∞–π–ª—ã.',
                            code: 'def __init__(self):\\n    self.session = requests.Session()\\n    self.session.headers.update(config.HEADERS)\\n    self.cookie_refresher = CookieRefresher(...)\\n    self.gemini_solver = GeminiSolver()',
                            junior: '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞–±–æ—Ç–µ. –ü—Ä–æ–≥—Ä–∞–º–º–∞ "–ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è", –Ω–∞–¥–µ–≤–∞–µ—Ç —Ä–∞–±–æ—á—É—é —Ñ–æ—Ä–º—É –∏ —Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.',
                            analogy: '–í–æ–¥–∏—Ç–µ–ª—å —Å–∞–¥–∏—Ç—Å—è –≤ –º–∞—à–∏–Ω—É, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∑–µ—Ä–∫–∞–ª–∞ –∏ –∑–∞–≤–æ–¥–∏—Ç –¥–≤–∏–≥–∞—Ç–µ–ª—å.'
                        }
                    },
                    {
                        data: {
                            id: 'fn_run',
                            label: '–ì–ª–∞–≤–Ω—ã–π –ö–æ–Ω–≤–µ–π–µ—Ä\\n(Run)',
                            parent: 'g_class',
                            type: 'function',
                            desc: '–û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏. –†–∞–∑–±–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —á–µ–∫–æ–≤ –Ω–∞ –ø–∞–∫–µ—Ç—ã –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫—É.',
                            code: 'def run(self, limit=None):\\n    checks = self.load_checks_from_excel()\\n    # ...\\n    for i in range(0, len(checks), batch_size):\\n        chunk = checks[i:i + batch_size]\\n        self.process_batch(chunk)',
                            junior: '–ì–ª–∞–≤–Ω—ã–π –Ω–∞—á–∞–ª—å–Ω–∏–∫. –û–Ω –±–µ—Ä–µ—Ç –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫ –¥–µ–ª –∏ –≤—ã–¥–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è –±—Ä–∏–≥–∞–¥–µ –ø–æ—Ä—Ü–∏—è–º–∏.',
                            analogy: '–ö–Ω–æ–ø–∫–∞ "–ü–£–°–ö" –Ω–∞ –∑–∞–≤–æ–¥—Å–∫–æ–º –∫–æ–Ω–≤–µ–π–µ—Ä–µ.'
                        }
                    },
                    {
                        data: {
                            id: 'fn_process',
                            label: '–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ü–∞–∫–µ—Ç–∞\\n(–ú–µ–Ω–µ–¥–∂–µ—Ä)',
                            parent: 'g_class',
                            type: 'function',
                            desc: '–ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –≥—Ä—É–ø–ø—ã —á–µ–∫–æ–≤: –∑–∞–≥—Ä—É–∑–∫–∞ -> –∫–∞–ø—á–∞ -> —Ä–µ—à–µ–Ω–∏–µ -> –æ—Ç–ø—Ä–∞–≤–∫–∞.',
                            code: 'def process_batch(self, checks_chunk):\\n    # 1. Upload files\\n    # 2. Get Captchas\\n    # 3. Solve with Gemini\\n    # 4. Submit all',
                            junior: '–ë—Ä–∏–≥–∞–¥–∏—Ä. –û–Ω –ø–æ–ª—É—á–∞–µ—Ç 12 –∑–∞–¥–∞–Ω–∏–π –∏ —Å–ª–µ–¥–∏—Ç, —á—Ç–æ–±—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ —à–∞–≥–∏.',
                            analogy: '–û—Ñ–∏—Ü–∏–∞–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç —Å—Ç–æ–ª–∏–∫ –∏–∑ 12 —á–µ–ª–æ–≤–µ–∫.'
                        }
                    },
                    {
                        data: {
                            id: 'fn_upload',
                            label: '–ó–∞–≥—Ä—É–∑—á–∏–∫\\n–§–∞–π–ª–æ–≤',
                            parent: 'g_class',
                            type: 'function',
                            desc: '–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ZIP-–∞—Ä—Ö–∏–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç base64 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ.',
                            code: 'def upload_file(self, check_number):\\n    payload = { "file": base64... }\\n    response = self.session.post(\\n        config.FILE_UPLOAD_URL, ...\\n    )\\n    return response.json().get("fileGuid")',
                            junior: '–§—É–Ω–∫—Ü–∏—è-–∫—É—Ä—å–µ—Ä. –ë–µ–∂–∏—Ç –≤ –Ω–∞–ª–æ–≥–æ–≤—É—é, –æ—Ç–¥–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –ø—Ä–∏–Ω–æ—Å–∏—Ç –Ω–æ–º–µ—Ä–æ–∫.',
                            analogy: '–°–¥–∞—á–∞ –æ–¥–µ–∂–¥—ã –≤ –≥–∞—Ä–¥–µ—Ä–æ–± –∑–∞ –Ω–æ–º–µ—Ä–æ–∫.'
                        }
                    },
                    {
                        data: {
                            id: 'fn_captcha',
                            label: '–ü–æ–ª—É—á–∞—Ç–µ–ª—å\\n–ö–∞–ø—á–∏',
                            parent: 'g_class',
                            type: 'function',
                            desc: '–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–æ–≤—É—é –∫–∞–ø—á—É —É —Å–µ—Ä–≤–µ—Ä–∞.',
                            code: 'def get_captcha(self):\\n    response = self.session.get(\\n        config.CAPTCHA_URL, ...\\n    )\\n    data = response.json()\\n    return data["guid"], data["captcha"]',
                            junior: '–°–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É —Å–µ—Ä–≤–µ—Ä–∞ –∑–∞–≥–∞–¥–∫—É (–∫–∞—Ä—Ç–∏–Ω–∫—É).',
                            analogy: '–í–∞—Ö—Ç–µ—Ä, –≤—ã–¥–∞—é—â–∏–π –ø—Ä–æ–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –ø–∞—Ä–æ–ª—é.'
                        }
                    },
                    {
                        data: {
                            id: 'fn_gemini',
                            label: '–†–µ—à–∞—Ç–µ–ª—å –ö–∞–ø—á–∏\\n(–ß–µ—Ä–µ–∑ –ò–ò)',
                            parent: 'g_ai',
                            type: 'function',
                            desc: '–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞–∫–µ—Ç –∫–∞—Ä—Ç–∏–Ω–æ–∫ –≤ Google Gemini –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.',
                            code: 'solved_captchas = self.gemini_solver.solve_batch(images_b64)\\n# –í–Ω—É—Ç—Ä–∏ GeminiSolver:\\n# response = model.generate_content(...)',
                            junior: '–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏ —É–º–Ω–æ–º—É –ò–ò –∏ –ø—Ä–æ—Å–∏—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ü–∏—Ñ—Ä—ã.',
                            analogy: '–ó–≤–æ–Ω–æ–∫ –¥—Ä—É–≥—É-–æ—Ç–ª–∏—á–Ω–∏–∫—É –∑–∞ –ø–æ–º–æ—â—å—é.'
                        }
                    },
                    {
                        data: {
                            id: 'fn_submit',
                            label: '–û—Ç–ø—Ä–∞–≤—â–∏–∫\\n–ß–µ–∫–∞',
                            parent: 'g_class',
                            type: 'function',
                            desc: '–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ–∫–∞.',
                            code: 'def submit_check_edit(self, ...):\\n    payload = { "captchaValue": ..., "attachedFile": ... }\\n    response = self.session.post(\\n        config.SUBMIT_URL, json=payload\\n    )',
                            junior: '–§–∏–Ω–∞–ª—å–Ω—ã–π —à–∞–≥. –ó–∞–ø–æ–ª–Ω—è–µ—Ç –∞–Ω–∫–µ—Ç—É –∏ –æ—Ç–¥–∞–µ—Ç –≤ –æ–∫–æ—à–∫–æ.',
                            analogy: '–û–ø—É—Å–∫–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ –ø–∏—Å—å–º–∞ –≤ –ø–æ—á—Ç–æ–≤—ã–π —è—â–∏–∫.'
                        }
                    },
                    {
                        data: {
                            id: 'fn_save',
                            label: '–°–æ—Ö—Ä–∞–Ω—è–ª—å—â–∏–∫',
                            parent: 'g_class',
                            type: 'function',
                            desc: '–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ JSON —Ñ–∞–π–ª.',
                            code: 'def save_progress(self):\\n    with open(config.PROGRESS_FILE, "w") as f:\\n        json.dump(list(self.progress), f)',
                            junior: '–°–µ–∫—Ä–µ—Ç–∞—Ä—å, –∑–∞–ø–∏—Å—ã–≤–∞—é—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∂—É—Ä–Ω–∞–ª.',
                            analogy: '–ì–∞–ª–æ—á–∫–∞ –≤ —Å–ø–∏—Å–∫–µ –¥–µ–ª.'
                        }
                    },

                    // Session Refresh Nodes
                    {
                        data: {
                            id: 'fn_detect401',
                            label: '–î–µ—Ç–µ–∫—Ç–æ—Ä 401\\n(–û—Ö—Ä–∞–Ω–Ω–∏–∫)',
                            parent: 'g_class',
                            type: 'function',
                            desc: '–ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ 401 Unauthorized.',
                            code: 'except requests.exceptions.HTTPError as e:\\n    if e.response.status_code == 401:\\n        return "unauthorized"',
                            junior: '–û—Ö—Ä–∞–Ω–Ω–∏–∫, –∑–∞–º–µ—á–∞—é—â–∏–π –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π –ø—Ä–æ–ø—É—Å–∫.',
                            analogy: '–¢—É—Ä–Ω–∏–∫–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø—É—Å–∫–∞–µ—Ç.'
                        }
                    },
                    {
                        data: {
                            id: 'fn_session_refresh',
                            label: '–û–±–Ω–æ–≤–ª—è—Ç–µ–ª—å\\n–°–µ—Å—Å–∏–∏',
                            parent: 'g_class',
                            type: 'function',
                            desc: '–ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏.',
                            code: 'def handle_session_expired(self):\\n    # Logic to restart Chrome and get cookies',
                            junior: '–ú–µ–Ω–µ–¥–∂–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å –ø—Ä–æ–ø—É—Å–∫–æ–º.',
                            analogy: '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è "–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –∑–∞–±—ã–ª –ø—Ä–æ–ø—É—Å–∫".'
                        }
                    },
                    {
                        data: {
                            id: 'fn_chrome_launcher',
                            label: '–ó–∞–ø—É—Å–∫–∞—Ç–µ–ª—å\\nChrome',
                            parent: 'g_class',
                            type: 'function',
                            desc: '–ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç START_CHROME_DEBUG.bat.',
                            code: 'subprocess.Popen([str(bat_file)], shell=True)',
                            junior: '–†–æ–±–æ—Ç, –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏–π –±—Ä–∞—É–∑–µ—Ä.',
                            analogy: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –¥–≤–µ—Ä–∏.'
                        }
                    },
                    {
                        data: {
                            id: 'user_login',
                            label: '–í—Ö–æ–¥ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\\n(–†—É—á–Ω–∞—è –†–∞–±–æ—Ç–∞)',
                            type: 'data',
                            desc: '–û–∂–∏–¥–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.',
                            code: 'input("\\nüëâ Press ENTER after you\'ve logged in: ")',
                            junior: '–¢—ã —Å–∞–º –≤–≤–æ–¥–∏—à—å –ø–∞—Ä–æ–ª—å.',
                            analogy: '–õ–∏—á–Ω–∞—è –ø–æ–¥–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª–µ.'
                        }
                    },
                    {
                        data: {
                            id: 'fn_cookie_extract',
                            label: '–ò–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å\\nCookies',
                            parent: 'g_class',
                            type: 'function',
                            desc: '–ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç refresh_cookies.py.',
                            code: 'subprocess.run([sys.executable, "refresh_cookies.py"])',
                            junior: '–®–ø–∏–æ–Ω, –∫–æ–ø–∏—Ä—É—é—â–∏–π –ø—Ä–æ–ø—É—Å–∫.',
                            analogy: '–ö—Å–µ—Ä–æ–∫—Å –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.'
                        }
                    },
                    {
                        data: {
                            id: 'fn_config_reload',
                            label: '–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞\\nConfig',
                            parent: 'g_class',
                            type: 'function',
                            desc: '–ü—Ä–∏–º–µ–Ω—è–µ—Ç –Ω–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.',
                            code: 'importlib.reload(config)\\nself.session.cookies.update(...)',
                            junior: '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã.',
                            analogy: '–°–º–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª –∏–≥—Ä—ã.'
                        }
                    },

                    // API Endpoints
                    {
                        data: {
                            id: 'api_upload',
                            label: 'API –ü—Ä–∏–µ–º–∞\\n–§–∞–π–ª–æ–≤',
                            parent: 'g_server',
                            type: 'api',
                            desc: 'URL: /api/general-api/file/repository-set-file',
                            code: 'config.FILE_UPLOAD_URL',
                            junior: '–û–∫–æ—à–∫–æ –ø—Ä–∏–µ–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.',
                            analogy: '–ü–æ—á—Ç–æ–≤–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ.'
                        }
                    },
                    {
                        data: {
                            id: 'api_captcha',
                            label: 'API –í—ã–¥–∞—á–∏\\n–ö–∞–ø—á–∏',
                            parent: 'g_server',
                            type: 'api',
                            desc: 'URL: /api/cashregister-edit-api/home/get-captcha',
                            code: 'config.CAPTCHA_URL',
                            junior: '–ê–≤—Ç–æ–º–∞—Ç —Å —Ç–∞–ª–æ–Ω—á–∏–∫–∞–º–∏.',
                            analogy: '–ë—É–¥–∫–∞ –æ—Ö—Ä–∞–Ω–Ω–∏–∫–∞.'
                        }
                    },
                    {
                        data: {
                            id: 'api_submit',
                            label: 'API –û–±—Ä–∞–±–æ—Ç–∫–∏\\n–ß–µ–∫–æ–≤',
                            parent: 'g_server',
                            type: 'api',
                            desc: 'URL: /api/cashregister-edit-api/check-edit/set-payment',
                            code: 'config.SUBMIT_URL',
                            junior: '–ì–ª–∞–≤–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞.',
                            analogy: '–°—É–¥—å—è, –≤—ã–Ω–æ—Å—è—â–∏–π —Ä–µ—à–µ–Ω–∏–µ.'
                        }
                    },
                    {
                        data: {
                            id: 'api_google',
                            label: 'Google Gemini\\nAPI',
                            parent: 'g_google',
                            type: 'api',
                            desc: 'Model: gemini-2.0-flash',
                            code: 'config.GEMINI_MODEL',
                            junior: '–ú–æ–∑–≥ Google.',
                            analogy: '–≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è.'
                        }
                    }
                ],
                edges: [
                    // Init flow
                    { data: { source: 'f_zip', target: 'fn_init', label: '–ß—Ç–µ–Ω–∏–µ', junior: '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ –ø–∞–º—è—Ç—å.', type: 'data', code: 'self.zip_file_content = f.read()' } },
                    { data: { source: 'f_progress', target: 'fn_init', label: '–ó–∞–≥—Ä—É–∑–∫–∞', junior: '–ß—Ç–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏.', type: 'data', code: 'self.progress = self.load_progress()' } },
                    { data: { source: 'fn_init', target: 'fn_run', label: '–°—Ç–∞—Ä—Ç', junior: '–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ä–∞–±–æ—Ç–µ.', type: 'control', code: 'automation.run()' } },

                    // Main loop
                    { data: { source: 'f_excel', target: 'fn_run', label: '–î–∞–Ω–Ω—ã–µ', junior: '–ß—Ç–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ Excel.', type: 'data', code: 'checks = self.load_checks_from_excel()' } },
                    { data: { source: 'fn_run', target: 'fn_process', label: '–í—ã–∑–æ–≤', junior: '–ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–∞–∫–µ—Ç–∞.', type: 'control', code: 'self.process_batch(chunk)' } },

                    // Processing Steps
                    // 1. Upload
                    { data: { source: 'fn_process', target: 'fn_upload', label: '–í—ã–∑–æ–≤', junior: '–ó–∞–ø—Ä–æ—Å –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É.', type: 'control', code: 'file_id = self.upload_file(check_number)' } },
                    { data: { source: 'fn_upload', target: 'api_upload', label: 'POST', junior: 'HTTP –∑–∞–ø—Ä–æ—Å.', type: 'api', payload: '{"file": "base64..."}', code: 'session.post(FILE_UPLOAD_URL, ...)' } },
                    { data: { source: 'api_upload', target: 'fn_upload', label: '–û—Ç–≤–µ—Ç', junior: '–í–æ–∑–≤—Ä–∞—Ç ID.', type: 'api', payload: '{"fileGuid": "..."}' } },
                    { data: { source: 'fn_upload', target: 'fn_process', label: 'Return', junior: '–í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.', type: 'data', code: 'return file_id' } },

                    // 2. Captcha
                    { data: { source: 'fn_process', target: 'fn_captcha', label: '–í—ã–∑–æ–≤', junior: '–ó–∞–ø—Ä–æ—Å –∫–∞–ø—á–∏.', type: 'control', code: 'captcha_id, img = self.get_captcha()' } },
                    { data: { source: 'fn_captcha', target: 'api_captcha', label: 'GET', junior: 'HTTP –∑–∞–ø—Ä–æ—Å.', type: 'api', code: 'session.get(CAPTCHA_URL)' } },
                    { data: { source: 'api_captcha', target: 'fn_captcha', label: '–û—Ç–≤–µ—Ç', junior: '–ö–∞—Ä—Ç–∏–Ω–∫–∞.', type: 'api', payload: '{"captcha": "base64..."}' } },
                    { data: { source: 'fn_captcha', target: 'fn_process', label: 'Return', junior: '–í–æ–∑–≤—Ä–∞—Ç.', type: 'data', code: 'return id, image' } },

                    // 3. Solve
                    { data: { source: 'fn_process', target: 'fn_gemini', label: '–í—ã–∑–æ–≤', junior: '–ó–∞–ø—Ä–æ—Å –∫ –ò–ò.', type: 'control', code: 'solver.solve_batch(images)' } },
                    { data: { source: 'fn_gemini', target: 'api_google', label: 'API Call', junior: '–°–µ—Ç–µ–≤–æ–π –∑–∞–ø—Ä–æ—Å.', type: 'api', payload: 'GenerateContentRequest', code: 'model.generate_content(...)' } },
                    { data: { source: 'api_google', target: 'fn_gemini', label: '–û—Ç–≤–µ—Ç', junior: '–¢–µ–∫—Å—Ç.', type: 'api', payload: 'Candidates[0].text' } },
                    { data: { source: 'fn_gemini', target: 'fn_process', label: 'Return', junior: '–í–æ–∑–≤—Ä–∞—Ç.', type: 'data', code: 'return ["123", ...]' } },

                    // 4. Submit
                    { data: { source: 'fn_process', target: 'fn_submit', label: '–í—ã–∑–æ–≤', junior: '–û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ–∫–∞.', type: 'control', code: 'self.submit_check_edit(...)' } },
                    { data: { source: 'fn_submit', target: 'api_submit', label: 'POST', junior: 'HTTP –∑–∞–ø—Ä–æ—Å.', type: 'api', payload: '{"paymentId": ..., "captchaValue": ...}', code: 'session.post(SUBMIT_URL, ...)' } },
                    { data: { source: 'api_submit', target: 'fn_submit', label: '–û—Ç–≤–µ—Ç', junior: '–†–µ–∑—É–ª—å—Ç–∞—Ç.', type: 'api', payload: '{"success": true}' } },

                    // 5. Save
                    { data: { source: 'fn_process', target: 'fn_save', label: '–í—ã–∑–æ–≤', junior: '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.', type: 'control', code: 'self.save_progress()' } },
                    { data: { source: 'fn_save', target: 'f_progress', label: 'Write', junior: '–ó–∞–ø–∏—Å—å –Ω–∞ –¥–∏—Å–∫.', type: 'data', code: 'json.dump(...)' } },

                    // Session Refresh Flow
                    { data: { source: 'fn_upload', target: 'fn_detect401', label: 'Catch', junior: '–ü–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–∫–∏.', type: 'control', code: 'except HTTPError:' } },
                    { data: { source: 'fn_submit', target: 'fn_detect401', label: 'Catch', junior: '–ü–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–∫–∏.', type: 'control', code: 'except HTTPError:' } },

                    { data: { source: 'fn_detect401', target: 'fn_session_refresh', label: 'Call', junior: '–ó–∞–ø—É—Å–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.', type: 'control', code: 'self.handle_session_expired()' } },

                    { data: { source: 'fn_session_refresh', target: 'fn_chrome_launcher', label: 'Exec', junior: '–ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞.', type: 'control', code: 'subprocess.Popen(...)' } },
                    { data: { source: 'fn_chrome_launcher', target: 'user_login', label: 'Wait', junior: '–û–∂–∏–¥–∞–Ω–∏–µ.', type: 'control', code: 'input("Press ENTER")' } },

                    { data: { source: 'user_login', target: 'fn_cookie_extract', label: 'Next', junior: '–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ.', type: 'control', code: 'subprocess.run(...)' } },

                    { data: { source: 'fn_cookie_extract', target: 'fn_config_reload', label: 'Update', junior: '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ.', type: 'data', code: 'reload(config)' } },

                    { data: { source: 'fn_config_reload', target: 'fn_process', label: 'Resume', junior: '–í–æ–∑–≤—Ä–∞—Ç –≤ —Ü–∏–∫–ª.', type: 'control', code: 'return True' } }
                ]
            },

            layout: {
                name: 'dagre',
                rankDir: 'LR',
                nodeSep: 50,
                rankSep: 100,
                padding: 40
            }
        });

        // Interaction Logic
        cy.on('tap', 'node', function (evt) {
            var node = evt.target;
            if (node.isParent()) return; // Don't show details for groups

            document.getElementById('default-info').style.display = 'none';
            document.getElementById('edge-details').style.display = 'none';
            document.getElementById('node-details').style.display = 'block';

            // Basic Info
            document.getElementById('node-name').innerHTML = node.data('label').replace(/\n/g, ' ');
            document.getElementById('node-description').innerHTML = node.data('desc');
            document.getElementById('node-code').innerHTML = node.data('code') || '// –ù–µ—Ç –ø—Ä–∏–º–µ—Ä–∞ –∫–æ–¥–∞';

            // Junior Info
            var juniorText = node.data('junior') || "–î–ª—è —ç—Ç–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è.";
            var analogyText = node.data('analogy');

            document.getElementById('node-junior-text').innerHTML = juniorText;

            if (analogyText) {
                document.getElementById('node-analogy-container').style.display = 'block';
                document.getElementById('node-analogy-text').innerHTML = analogyText;
            } else {
                document.getElementById('node-analogy-container').style.display = 'none';
            }

            // Tags
            var type = node.data('type');
            var typeLabel = type === 'function' ? '–§—É–Ω–∫—Ü–∏—è (–ö–æ–¥)' : type === 'data' ? '–§–∞–π–ª (–î–∞–Ω–Ω—ã–µ)' : 'API (–°–µ—Ä–≤–∏—Å)';
            var typeClass = type === 'function' ? 'tag-logic' : type === 'data' ? 'tag-data' : 'tag-tech';

            document.getElementById('node-tags').innerHTML = `<span class="tag ${typeClass}">${typeLabel}</span>`;

            // Connections
            var connections = node.connectedEdges();
            var listHtml = '';
            connections.forEach(function (edge) {
                var isSource = edge.source().id() === node.id();
                var otherNode = isSource ? edge.target() : edge.source();
                var arrow = isSource ? '‚Üí' : '‚Üê';
                var color = isSource ? '#4ec9b0' : '#ce9178';
                listHtml += `<li style="border-left-color:${color}">
                    <span style="color:${color}; font-weight:bold; font-size:16px;">${arrow}</span>
                    <div>
                        <div style="font-weight:bold; color:#eee;">${otherNode.data('label').replace(/\n/g, ' ')}</div>
                        <div style="font-size:11px; color:#888;">${edge.data('label')}</div>
                    </div>
                </li>`;
            });
            document.getElementById('node-connections').innerHTML = listHtml;

            highlightElement(node);
        });

        cy.on('tap', 'edge', function (evt) {
            var edge = evt.target;

            document.getElementById('default-info').style.display = 'none';
            document.getElementById('node-details').style.display = 'none';
            document.getElementById('edge-details').style.display = 'block';

            var sourceName = edge.source().data('label').replace(/\n/g, ' ');
            var targetName = edge.target().data('label').replace(/\n/g, ' ');

            document.getElementById('edge-name').innerHTML = `${sourceName} <span style="color:#4fc1ff">‚Üí</span> ${targetName}`;
            document.getElementById('edge-junior-text').innerHTML = edge.data('junior') || "–ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏.";
            document.getElementById('edge-payload').innerHTML = edge.data('payload') || "–°–∏–≥–Ω–∞–ª —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è";
            document.getElementById('edge-timing').innerHTML = edge.data('type') === 'api' ? "‚è±Ô∏è –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ—Ç–∏" : "‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ";

            highlightElement(edge);
        });

        cy.on('tap', function (evt) {
            if (evt.target === cy) {
                resetHighlight();
                document.getElementById('node-details').style.display = 'none';
                document.getElementById('edge-details').style.display = 'none';
                document.getElementById('default-info').style.display = 'block';
            }
        });

        function highlightElement(ele) {
            resetHighlight();
            ele.addClass('highlighted');
            if (ele.isNode()) {
                ele.connectedEdges().addClass('highlighted');
                ele.connectedEdges().connectedNodes().addClass('highlighted');
            } else {
                ele.source().addClass('highlighted');
                ele.target().addClass('highlighted');
            }
        }

        function resetHighlight() {
            cy.elements().removeClass('highlighted dimmed');
        }

        // Navigation Functions
        function resetView() {
            cy.fit();
            cy.center();
            resetHighlight();
        }

        function fitView() { cy.fit(); }
        function zoomIn() { cy.zoom(cy.zoom() * 1.2); }
        function zoomOut() { cy.zoom(cy.zoom() / 1.2); }

        function showCriticalPath() {
            resetHighlight();
            var pathIds = ['f_excel', 'fn_run', 'fn_process', 'fn_upload', 'api_upload', 'fn_captcha', 'api_captcha', 'fn_gemini', 'api_google', 'fn_submit', 'api_submit', 'fn_save'];
            pathIds.forEach(id => {
                var el = cy.getElementById(id);
                el.addClass('highlighted');
                el.connectedEdges().addClass('highlighted');
            });
            cy.fit(cy.elements('.highlighted'), 50);
        }

        // Init
        cy.ready(function () {
            cy.fit();
        });

        // Search
        document.getElementById('search-box').addEventListener('input', function (e) {
            var term = e.target.value.toLowerCase();
            if (!term) { resetHighlight(); return; }

            cy.elements().removeClass('highlighted');
            var found = cy.nodes().filter(n => n.data('label').toLowerCase().includes(term));
            found.addClass('highlighted');
        });

    </script>
    <script type="module" src="/index.tsx"></script>
</body>

</html>